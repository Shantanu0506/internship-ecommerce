<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Review Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-4">

    <h2>Review & Rating Dashboard</h2>

    <!-- ADD REVIEW -->
    <div class="card p-3 mt-4">
        <h5>Add Review</h5>

        <div class="row">
            <div class="col-md-3">
                <label>Product ID</label>
                <input id="productId" type="number" class="form-control">
            </div>

            <div class="col-md-3">
                <label>Customer ID</label>
                <input id="customerId" type="number" class="form-control">
            </div>

            <div class="col-md-3">
                <label>Rating (1â€“5)</label>
                <input id="rating" type="number" min="1" max="5" class="form-control">
            </div>

            <div class="col-md-12 mt-3">
                <label>Review Text</label>
                <textarea id="reviewText" class="form-control"></textarea>
            </div>
        </div>

        <button class="btn btn-primary mt-3" onclick="addReview()">Add Review</button>
    </div>

    <!-- TABLE -->
    <table class="table table-bordered mt-4">
        <thead>
            <tr>
                <th>ID</th>
                <th>Product</th>
                <th>Customer</th>
                <th>Rating</th>
                <th>Review</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody id="reviewTable"></tbody>
    </table>

</div>

<script>
const base = "http://localhost:8080/api/reviews";

function loadReviews() {
    fetch(base)
    .then(r => r.json())
    .then(data => {
        let html = "";
        data.forEach(rv => {
            html += `
            <tr>
                <td>${rv.reviewId}</td>
                <td>${rv.product.productId}</td>
                <td>${rv.customer.userId}</td>
                <td>${rv.rating}</td>
                <td>${rv.reviewText}</td>
                <td>${rv.status ? "Approved" : "Pending"}</td>
                <td>
                    <button class="btn btn-success btn-sm" onclick="approve(${rv.reviewId})">Approve</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteReview(${rv.reviewId})">Delete</button>
                </td>
            </tr>
            `;
        });

        document.getElementById("reviewTable").innerHTML = html;
    });
}

function addReview() {
    let product = document.getElementById("productId").value;
    let customer = document.getElementById("customerId").value;

    let obj = {
        rating: document.getElementById("rating").value,
        reviewText: document.getElementById("reviewText").value
    };

    fetch(base + `/add?productId=${product}&customerId=${customer}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(obj)
    }).then(() => loadReviews());
}

function approve(id) {
    fetch(base + `/approve/${id}`, { method: "PUT" })
    .then(() => loadReviews());
}

function deleteReview(id) {
    fetch(base + `/${id}`, { method: "DELETE" })
    .then(() => loadReviews());
}

loadReviews();
</script>

</body>
</html>
