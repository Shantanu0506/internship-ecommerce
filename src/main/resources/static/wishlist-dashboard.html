<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wishlist Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-4">
    <h2>Wishlist Dashboard</h2>

    <!-- Customer selection -->
    <div class="mb-3">
        <label>Select Customer:</label>
        <select id="customerSelect" class="form-select" style="max-width:300px;">
        </select>
    </div>

    <!-- Optional: Add new wishlist item -->
    <div class="card mb-3" style="max-width:500px;">
        <div class="card-body">
            <h5 class="card-title">Add to Wishlist</h5>
            <div class="mb-2">
                <label>Product:</label>
                <select id="productSelect" class="form-select">
                </select>
            </div>
            <button class="btn btn-primary" onclick="addToWishlist()">Add</button>
        </div>
    </div>

    <!-- Wishlist table -->
    <table class="table table-striped">
        <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Product</th>
            <th>Price (₹)</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="wishlistTableBody"></tbody>
    </table>

    <div id="emptyText" class="text-muted" style="display:none;">
        No items in wishlist.
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    loadCustomers();
    loadProducts();
});

function loadCustomers() {
    fetch("/api/users")
        .then(r => r.json())
        .then(data => {
            const select = document.getElementById("customerSelect");
            select.innerHTML = "";

            data.forEach(c => {
                if (c.status) {
                    const opt = document.createElement("option");
                    opt.value = c.id;
                    opt.textContent = c.firstName + " " + c.lastName;
                    select.appendChild(opt);
                }
            });

            select.addEventListener("change", loadWishlist);
            loadWishlist();
        });
}

function loadProducts() {
    fetch("/api/products")
        .then(r => r.json())
        .then(data => {
            const select = document.getElementById("productSelect");
            select.innerHTML = "";

            data.forEach(p => {
                if (p.status) {
                    const opt = document.createElement("option");
                    opt.value = p.id;
                    opt.textContent = p.productName + " (₹" + p.price + ")";
                    select.appendChild(opt);
                }
            });
        });
}

function loadWishlist() {
    const customerId = document.getElementById("customerSelect").value;

    fetch(`/api/wishlist/${customerId}`)
        .then(r => r.json())
        .then(data => {
            const body = document.getElementById("wishlistTableBody");
            const empty = document.getElementById("emptyText");

            body.innerHTML = "";

            if (data.length === 0) {
                empty.style.display = "block";
                return;
            }
            empty.style.display = "none";

            data.forEach(item => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${item.id}</td>
                    <td>${item.product.productName}</td>
                    <td>₹${item.product.price}</td>
                    <td>
                        <button class="btn btn-sm btn-success me-2"
                            onclick="moveToCart(${item.id})">Move to Cart</button>
                        <button class="btn btn-sm btn-danger"
                            onclick="removeFromWishlist(${item.id})">Remove</button>
                    </td>
                `;
                body.appendChild(tr);
            });
        });
}

function addToWishlist() {
    const customerId = document.getElementById("customerSelect").value;
    const productId = document.getElementById("productSelect").value;

    fetch(`/api/wishlist/add?customerId=${customerId}&productId=${productId}`, {
        method: "POST"
    })
    .then(() => loadWishlist());
}

function removeFromWishlist(id) {
    fetch(`/api/wishlist/${id}`, { method: "DELETE" })
        .then(() => loadWishlist());
}

function moveToCart(id) {
    fetch(`/api/wishlist/${id}/move-to-cart`, { method: "POST" })
        .then(() => loadWishlist());
}
</script>

</body>
</html>
