<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shipping Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-4">

    <h2 class="mb-4">Shipping Dashboard</h2>

    <!-- ADD SHIPPING -->
    <div class="card p-3 mb-4">
        <h5>Add Shipping</h5>

        <div class="row">
            <div class="col-md-3">
                <label>Order ID</label>
                <input type="number" id="orderId" class="form-control">
            </div>

            <div class="col-md-3">
                <label>Courier Service</label>
                <input type="text" id="courier" class="form-control">
            </div>

            <div class="col-md-3">
                <label>Tracking Number</label>
                <input type="text" id="tracking" class="form-control">
            </div>

            <div class="col-md-3">
                <label>Shipping Cost</label>
                <input type="number" id="cost" class="form-control">
            </div>
        </div>

        <div class="mt-3">
            <button class="btn btn-primary" onclick="addShipping()">Add</button>
        </div>
    </div>

    <!-- TABLE -->
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Order</th>
                <th>Courier</th>
                <th>Tracking</th>
                <th>Status</th>
                <th>Cost</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="shippingTable"></tbody>
    </table>

</div>

<script>
const base = "http://localhost:8080/api/shipping";

function loadShipping(){
    fetch(base)
    .then(res=>res.json())
    .then(data=>{
        let html="";
        data.forEach(s=>{
            html+=`
            <tr>
                <td>${s.shippingId}</td>
                <td>${s.order.orderId}</td>
                <td>${s.courierService}</td>
                <td>${s.trackingNumber}</td>
                <td>${s.shippingStatus}</td>
                <td>${s.shippingCost}</td>
                <td>
                    <button class="btn btn-sm btn-info" onclick="markShipped(${s.shippingId})">Mark Shipped</button>
                </td>
            </tr>`;
        });
        document.getElementById("shippingTable").innerHTML = html;
    })
}

function addShipping(){
    let obj = {
        courierService: document.getElementById("courier").value,
        trackingNumber: document.getElementById("tracking").value,
        shippingStatus: "In Transit",
        shippingCost: parseFloat(document.getElementById("cost").value)
    };

    let orderId = document.getElementById("orderId").value;

    fetch(base+"/add/"+orderId,{
        method:"POST",
        headers:{ "Content-Type":"application/json"},
        body:JSON.stringify(obj)
    }).then(()=>loadShipping());
}

function markShipped(id){
    let obj = { shippingStatus:"Delivered" };

    fetch(base+"/"+id,{
        method:"PUT",
        headers:{ "Content-Type":"application/json"},
        body:JSON.stringify(obj)
    }).then(()=>loadShipping());
}

loadShipping();
</script>

</body>
</html>
