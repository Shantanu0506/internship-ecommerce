<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cart Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-4">
    <h2>Cart Dashboard</h2>

    <div class="mb-3">
        <label>Select Customer:</label>
        <select id="customerSelect" class="form-select" style="max-width:300px;">
        </select>
    </div>

    <table class="table table-striped mt-4">
        <thead class="table-dark">
        <tr>
            <th>Cart ID</th>
            <th>Product</th>
            <th>Qty</th>
            <th>Total Price</th>
            <th>Actions</th>
        </tr>
        </thead>

        <tbody id="cartTableBody">
        </tbody>
    </table>

    <div id="emptyText" class="text-muted" style="display:none;">No items in the cart.</div>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    loadCustomers();

    document.getElementById("customerSelect").addEventListener("change", () => {
        loadCart();
    });
});

function loadCustomers() {
    fetch("/api/users")
        .then(r => r.json())
        .then(data => {
            const select = document.getElementById("customerSelect");
            data.forEach(c => {
                if (c.status) {
                    let opt = document.createElement("option");
                    opt.value = c.id;
                    opt.textContent = c.firstName + " " + c.lastName;
                    select.appendChild(opt);
                }
            });
            loadCart();
        });
}

function loadCart() {
    let customerId = document.getElementById("customerSelect").value;
    fetch(`/api/cart/${customerId}`)
        .then(r => r.json())
        .then(data => {
            const body = document.getElementById("cartTableBody");
            const empty = document.getElementById("emptyText");

            body.innerHTML = "";

            if (data.length === 0) {
                empty.style.display = "block";
                return;
            }
            empty.style.display = "none";

            data.forEach(item => {
                let tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${item.id}</td>
                    <td>${item.product.productName}</td>
                    <td>
                        <input type="number" min="1" value="${item.quantity}"
                        onchange="updateQuantity(${item.id}, this.value)" style="width:70px;">
                    </td>
                    <td>â‚¹${item.totalPrice}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteItem(${item.id})">Remove</button>
                    </td>
                `;
                body.appendChild(tr);
            });
        });
}

function updateQuantity(cartId, qty) {
    fetch(`/api/cart/${cartId}?quantity=${qty}`, {
        method: "PUT"
    })
    .then(() => loadCart());
}

function deleteItem(cartId) {
    fetch(`/api/cart/${cartId}`, { method: "DELETE" })
        .then(() => loadCart());
}
</script>

</body>
</html>
